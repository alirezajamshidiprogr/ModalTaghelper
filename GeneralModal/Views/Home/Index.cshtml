@using GeneralModal.Models
@using GeneralModal.TagHelper

<!-- CSS Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384‑sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous">

<!-- JS Bundle Bootstrap (شامل Popper و سایر پلاگین‌ها) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384‑FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>



@{
    var modal = new GenericModalBuilder("myModal")
        .Title("مدال نمونه") // اگر HeaderHtml ندادید، Title نمایش داده می‌شود
        .HeaderHtml("<h5 class='modal-title'>عنوان دلخواه هدر</h5>") // HTML دلخواه هدر
        .Size("lg")
        .BodyHtml(
            new TextBox { Id = "txtName", Class = "form-control", Placeholder = "نام خود را وارد کنید", Required = true, MinLength = 3, MaxLength = 50, ValidationMessage = "نام باید بین 3 تا 50 کاراکتر باشد." },
            new TextBox { Id = "txtEmail", Class = "form-control", Placeholder = "ایمیل خود را وارد کنید", Required = true, Pattern = @"^[^@\s]+@[^@\s]+\.[^@\s]+$", ValidationMessage = "ایمیل نامعتبر است." },
            new PasswordBox { Id = "txtPassword", Class = "form-control", Placeholder = "رمز عبور", Required = true, MinLength = 6, ValidationMessage = "رمز عبور حداقل 6 کاراکتر باشد." },
            new TextArea { Id = "txtMessage", Class = "form-control", Placeholder = "پیام خود را وارد کنید", Rows = 4 },
            new CheckBox { Id = "chkAgree", Class = "form-check-input", Required = true, ValidationMessage = "باید تیک توافق را بزنید." },
            new Select { Id = "selOptions", Class = "form-select", InnerHtml = "<option value=''>انتخاب کنید</option><option value='1'>گزینه 1</option><option value='2'>گزینه 2</option>", Required = true, ValidationMessage = "لطفاً یک گزینه انتخاب کنید." }
        )
        .FooterHtml(@"
    <button class='btn btn-secondary' >لغو</button>
    <button class='btn btn-primary' onclick='submitModalForm()'>ثبت</button>
")
        .Build();
}

@modal

<div class="text-center mt-5">
    <button class="btn btn-primary" onclick="openModal()">
        باز کردن مدال Fluent
    </button>
</div>

<script>
    function openModal() {
        const myModalEl = document.getElementById('myModal');
        const myModal = bootstrap.Modal.getInstance(myModalEl) || new bootstrap.Modal(myModalEl, { backdrop: 'static', keyboard: false });
        myModal.show();
    }

    function submitModalForm() {
        const modal = document.getElementById('myModal');
        const inputs = modal.querySelectorAll('input, select, textarea');
        let valid = true;
        let firstInvalid = null;

        inputs.forEach(input => {
            if (!input.checkValidity()) {
                valid = false;
                input.classList.add('is-invalid');
                if (!firstInvalid) firstInvalid = input;
            } else {
                input.classList.remove('is-invalid');
            }
        });

        if (!valid) {
            firstInvalid.focus();
            return;
        }

        // اگر همه چیز درست بود، می‌توانید فرم را submit کنید یا Ajax بزنید4
        alert("فرم با موفقیت ارسال شد!");
        // بستن مدال
        const bsModal = bootstrap.Modal.getInstance(modal);
    }
</script>

<style>
    /* استایل خطای validation */
    .is-invalid {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220,53,69,.25);
    }

    .form-check-input.is-invalid {
        outline: 0;
        border-color: #dc3545;
    }
</style>
